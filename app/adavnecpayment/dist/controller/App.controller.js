sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Item","sap/m/Dialog","sap/m/Button"],function(e,t,a,r,o,i){"use strict";var n=0;var s=0;var l=0;var d=window.location.href;function u(e,t){const a=e.indexOf("#");const r=a!==-1?e.substring(a+1):"";const o=r.indexOf("?");const i=o!==-1?r.substring(o+1):"";const n=new URLSearchParams(i);return n.get(t)}const p=u(d,"semadv");return e.extend("adavnecpayment.controller.App",{onInit:function(){},onBeforeRendering:async function(e){debugger;this.byId("submit").setVisible(false);let t="getcallforpartnerline";var a=e.oSource.getParent().getModel().bindContext(`/${t}(...)`);a.setParameter("orderNumber",p);try{await a.execute()}catch(e){console.log(e)}var r=this.byId("table_partner").mBindingInfos.items.binding;r.filter(new sap.ui.model.Filter({path:"orderNumber",operator:sap.ui.model.FilterOperator.EQ,value1:p}));r.refresh();debugger;var o=this.byId("table_line").mBindingInfos.items.binding;o.filter(new sap.ui.model.Filter({path:"orderNumber",operator:sap.ui.model.FilterOperator.EQ,value1:p}));o.refresh();var i=this.byId("inLineItems").mBindingInfos.items.binding;i.filter(new sap.ui.model.Filter({path:"orderNumber",operator:sap.ui.model.FilterOperator.EQ,value1:p}));i.refresh();var n=this.byId("uploadSet").mBindingInfos.items.binding;n.filter(new sap.ui.model.Filter({path:"orderNumber",operator:sap.ui.model.FilterOperator.EQ,value1:p}));n.refresh();var s=this.byId("uploadSe3t").mBindingInfos.items.binding;s.filter(new sap.ui.model.Filter({path:"orderNumber",operator:sap.ui.model.FilterOperator.EQ,value1:p}));s.refresh();var l=this.byId("uploadSet2").mBindingInfos.items.binding;l.filter(new sap.ui.model.Filter({path:"orderNumber",operator:sap.ui.model.FilterOperator.EQ,value1:p}));l.refresh();var d=this.byId("uploa2dSet").mBindingInfos.items.binding;d.filter(new sap.ui.model.Filter({path:"regID",operator:sap.ui.model.FilterOperator.EQ,value1:"test"}));d.refresh()},invoiceNum:async function(e){debugger;var t=this.byId("inp-a").getValue();let a="validation";var r=e.oSource.getParent().getModel().bindContext(`/${a}(...)`);r.setParameter("invoiceno",t);try{await r.execute()}catch(e){console.log(e)}let o=r.getBoundContext();let i=o.getValue();let n=i.value;if(n!=t){this.byId("inp-a").setValueState("None");this.byId("inp-a").setValueStateText("")}else{this.byId("inp-a").setValueState("Error");this.byId("inp-a").setValueStateText(`Invoice No ${t} already exists `);this.byId("submit").setVisible(false)}},invoiceVal:async function(e){debugger;var t=this.byId("inp-c").getValue();var a=this.byId("input-12").getValue();if(parseFloat(t)<=parseFloat(a)){this.byId("inp-c").setValueState("None");this.byId("inp-c").setValueStateText("");this.byId("submit").setVisible(true)}else{this.byId("inp-c").setValueState("Error");this.byId("inp-c").setValueStateText(`Amount entered ${t} is greater than ${a} `);this.byId("submit").setVisible(false)}},Submit:async function(e){debugger;var t=this.byId("inp-a").mProperties.value;var a=this.byId("inp-b").mProperties.value;var r=this.byId("inp-c").mProperties.value;debugger;let o="postcall";var i=e.oSource.getParent().getModel().bindContext(`/${o}(...)`);i.setParameter("invoiceno",t);i.setParameter("invoicedate",a);i.setParameter("invoicevalue",r);i.setParameter("poNum",p);try{await i.execute()}catch(e){console.log(e)}console.log("func completed");let n=i.getBoundContext();let s=n.getValue();let l=s.value;let d=new sap.m.Dialog({title:"Success",type:"Message",content:new sap.m.Text({text:`Advance Payment request created successfully,Referece-ID : ${l}`}),beginButton:new sap.m.Button({type:"Accept",text:"OK",press:async function(e,t){d.close();window.history.back()}})});d.open()},onRowSelected:async function(e){debugger;var t=e.getSource().getItems();for(let b=0;b<t.length;b++){if(t[b].getSelected()==true){let v=p;let h=t[b].mAggregations.cells[0].mProperties.text;let f="fm1";var a=e.oSource.getParent().getModel().bindContext(`/${f}(...)`);a.setParameter("orderNumber",v);a.setParameter("itemNo",h);a.setParameter("type","checked");await a.execute();this.byId("inLineItems").mBindingInfos.items.binding.refresh();var r=a.getBoundContext().getValue().value;var o=r.amount;debugger;if(r.checked=="true"){var o=r.amount;if(o.includes(",")){o=parseFloat(o.replace(/,/g,""))}else{o=parseFloat(o)}}n=parseFloat(n)+o;var i=parseFloat(t[b].mAggregations.cells[6].mProperties.text);var d=parseFloat(t[b].mAggregations.cells[7].mProperties.text);var u=parseFloat(o*i/100);var g=parseFloat(o*d/100);var m=parseFloat(t[b].mAggregations.cells[9].mProperties.text);s=parseFloat(s)+g;var c=parseFloat(t[b].mAggregations.cells[8].mProperties.text);l=parseFloat(l)+u}else{let r=p;let o=t[b].mAggregations.cells[0].mProperties.text;let i="fm1";var a=e.oSource.getParent().getModel().bindContext(`/${i}(...)`);a.setParameter("orderNumber",r);a.setParameter("itemNo",o);a.setParameter("type","unchecked");await a.execute();this.byId("inLineItems").mBindingInfos.items.binding.refresh()}}n=parseFloat(n.toFixed(2));this.byId("input-a").setValue(n);l=parseFloat(l.toFixed(2));this.byId("input-9").setValue(l);s=parseFloat(s.toFixed(2));this.byId("input-11").setValue(s);var b=n+l+s;b=parseFloat(b.toFixed(2));this.byId("input-12").setValue(b);n=0;s=0;l=0},submit:async function(e){debugger;var t=p;var a=e.getSource().getParent().mAggregations.cells[0].mProperties.text;var r=parseFloat(e.mParameters.value);let o="fm3";var i=e.oSource.getParent().getModel().bindContext(`/${o}(...)`);i.setParameter("poNum",t);i.setParameter("itemId",a);await i.execute();var n=i.getBoundContext().getValue().value;var s=JSON.parse(n);if(r>parseFloat(s[0].lineItemQuant_static)){e.getSource().setValueState("Error");e.getSource().setValueStateText(`Quantity is more than ${s[0].lineItemQuant_static}`)}else if(r<=parseFloat(s[0].lineItemQuant_static)){e.getSource().setValueState("None");var a=e.getSource().getParent().mAggregations.cells[0].mProperties.text;var l=e.getSource().getParent().mAggregations.cells[5].mProperties.value;var d=e.getSource().getParent().mAggregations.cells[9].mProperties.text;var u=e.getSource().getParent().mAggregations.cells[10].mProperties.text;let o="fm2";var i=e.oSource.getParent().getModel().bindContext(`/${o}(...)`);i.setParameter("poNum",t);i.setParameter("itemId",a);i.setParameter("quantity",r);i.setParameter("unitPrice",l);i.setParameter("sgst_value",d);i.setParameter("cgst_value",u);await i.execute();var n=i.getBoundContext().getValue().value;var s=JSON.parse(n);this.byId("table_line").mBindingInfos.items.binding.refresh();this.byId("inLineItems").mBindingInfos.items.binding.refresh();var g=0;var m=0;var c=0;let p=e.oSource.oParent.oParent.mAggregations.items;for(let e=0;e<p.length;e++){if(s[0].itemNo==p[e].mAggregations.cells[0].mProperties.text){g=parseFloat(g)+parseFloat(s[0].amount_dynamic);m=parseFloat(m)+parseFloat(s[0].sgstValue);c=parseFloat(c)+parseFloat(s[0].cgstValue);continue}var b=p[e].mAggregations.cells[10].mProperties.text;if(b.includes(",")){b=parseFloat(b.replace(/,/g,""))}else{b=parseFloat(b)}g=parseFloat(g)+b;var v=parseFloat(p[e].mAggregations.cells[9].mProperties.text);m=parseFloat(m)+v;var h=parseFloat(p[e].mAggregations.cells[8].mProperties.text);c=parseFloat(c)+h}g=parseFloat(g.toFixed(2));this.byId("input-a").setValue(g);c=parseFloat(c.toFixed(2));this.byId("input-9").setValue(c);m=parseFloat(m.toFixed(2));this.byId("input-11").setValue(m);var f=g+c+m;f=f.toFixed(2);this.byId("input-12").setValue(f)}},onAfterItemAdded:function(e){debugger;var t=e.getParameter("item");var a=this.getView().getModel().sServiceUrl;var r=function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size,orderNumber:p};var r={url:a+`Files`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(r).done((t,a,r)=>{debugger;e(t.ID)}).fail(e=>{t(e)})})};debugger;r(t).then(e=>{debugger;var r=a+`Files(ID=${e})/content`;t.setUploadUrl(r);var o=this.byId("uploadSet");o.setHttpRequestMethod("PUT");o.uploadItem(t)}).catch(e=>{debugger;console.log(e)})},onUploadCompleted:function(e){debugger;var t=this.byId("uploadSet");t.removeAllIncompleteItems();t.getBinding("items").refresh()},onRemovePressed:function(e){e.preventDefault();e.getParameter("item").getBindingContext().delete();t.show("Selected file has been deleted")},onOpenPressed:function(e){debugger;e.preventDefault();var t=e.getSource();var a=t.getFileName();var r=function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{console.log("Downloaded Blob:",t);e(t)}).fail(e=>{console.error("Download Error:",e);a(e)})})};r(t).then(e=>{var t=window.URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>{console.log(e)})},_download:function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntity:function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/my/Files",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,r)=>{e(t.ID)}).fail(e=>{t(e)})})},_uploadContent:function(e,t){debugger;var a=`/my/Files(${req.data.ID})/content`;e.setUploadUrl(a);var r=this.byId("uploadSet");r.setHttpRequestMethod("PUT");r.uploadItem(e)},formatThumbnailUrl:function(e){debugger;var t;switch(e){case"image/png":t="sap-icon://card";break;case"text/plain":t="sap-icon://document-text";break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":t="sap-icon://excel-attachment";break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":t="sap-icon://doc-attachment";break;case"application/pdf":t="sap-icon://pdf-attachment";break;default:t="sap-icon://attachment"}return t},onAfterItemAddedComp:function(e){debugger;var t=e.getParameter("item");var a=this.getView().getModel().sServiceUrl;var r=function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size,orderNumber:p};var r={url:a+`Files1`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(r).done((t,a,r)=>{debugger;e(t.ID)}).fail(e=>{t(e)})})};debugger;r(t).then(e=>{debugger;var r=a+`Files1(ID=${e})/content`;t.setUploadUrl(r);var o=this.byId("uploadSe3t");o.setHttpRequestMethod("PUT");o.uploadItem(t)}).catch(e=>{debugger;console.log(e)})},onUploadCompletedComp:function(e){debugger;var t=this.byId("uploadSe3t");t.removeAllIncompleteItems();t.getBinding("items").refresh()},onOpenPressedComp:function(e){debugger;e.preventDefault();var t=e.getSource();var a=t.getFileName();var r=function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{console.log("Downloaded Blob:",t);e(t)}).fail(e=>{console.error("Download Error:",e);a(e)})})};r(t).then(e=>{var t=window.URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>{console.log(e)})},_downloadComp:function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntityComp:function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/my/Files1",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,r)=>{e(t.ID)}).fail(e=>{t(e)})})},_uploadContentComp:function(e,t){debugger;var a=`/my/Files1(${req.data.ID})/content`;e.setUploadUrl(a);var r=this.byId("uploadSet2");r.setHttpRequestMethod("PUT");r.uploadItem(e)},onAfterItemAddedDoc:function(e){debugger;var t=e.getParameter("item");var a=this.getView().getModel().sServiceUrl;var r=function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size,orderNumber:p};var r={url:a+`Files2`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(r).done((t,a,r)=>{debugger;e(t.ID)}).fail(e=>{t(e)})})};debugger;r(t).then(e=>{debugger;var r=a+`Files2(ID=${e})/content`;t.setUploadUrl(r);var o=this.byId("uploadSet2");o.setHttpRequestMethod("PUT");o.uploadItem(t)}).catch(e=>{debugger;console.log(e)})},onUploadCompletedDoc:function(e){debugger;var t=this.byId("uploadSet2");t.removeAllIncompleteItems();t.getBinding("items").refresh()},onOpenPressedDoc:function(e){debugger;e.preventDefault();var t=e.getSource();var a=t.getFileName();var r=function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{console.log("Downloaded Blob:",t);e(t)}).fail(e=>{console.error("Download Error:",e);a(e)})})};r(t).then(e=>{var t=window.URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>{console.log(e)})},_downloadDoc:function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntityDoc:function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/my/Files2",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,r)=>{e(t.ID)}).fail(e=>{t(e)})})},_uploadContentDoc:function(e,t){debugger;var a=`/my/Files2(${req.data.ID})/content`;e.setUploadUrl(a);var r=this.byId("uploadSet");r.setHttpRequestMethod("PUT");r.uploadItem(e)},onAfterItemAddedAttach:function(e){debugger;var t=e.getParameter("item");var a=this.getView().getModel().sServiceUrl;var r=function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size,orderNumber:p,regID:"test"};var r={url:a+`Files3`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(r).done((t,a,r)=>{debugger;e(t.ID)}).fail(e=>{t(e)})})};debugger;r(t).then(e=>{debugger;var r=a+`Files3(ID=${e})/content`;t.setUploadUrl(r);var o=this.byId("uploa2dSet");o.setHttpRequestMethod("PUT");o.uploadItem(t)}).catch(e=>{debugger;console.log(e)})},onUploadCompletedAttach:function(e){debugger;var t=this.byId("uploa2dSet");t.removeAllIncompleteItems();t.getBinding("items").refresh();var a=this.byId("uploa2dSet").mBindingInfos.items.binding;a.filter(new sap.ui.model.Filter({path:"regID",operator:sap.ui.model.FilterOperator.EQ,value1:"test"}));a.refresh()},onOpenPressedAttach:function(e){debugger},_downloadAttach:function(e){var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntityAttach:function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/my/Files3",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,r)=>{e(t.ID)}).fail(e=>{t(e)})})},_uploadContentAttach:function(e,t){debugger;var a=`/my/Files3(${req.data.ID})/content`;e.setUploadUrl(a);var r=this.byId("uploa2dSet");r.setHttpRequestMethod("PUT");r.uploadItem(e)}})});
//# sourceMappingURL=App.controller.js.map